(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[706],{4530:()=>{},8108:()=>{},18590:()=>{},31635:(e,n,t)=>{"use strict";t.r(n),t.d(n,{cosineSimilarity:()=>y,getEmbedding:()=>f,loadModels:()=>u});var o=t(1490),a=t(84932),i=t(27476),l=t(19874),r=t.n(l);let s="".concat("/Biometrics-SimFace-Web","/models/edgeface_s_gamma_05.onnx"),d=null,c=null,m=null;async function u(){if(d&&c&&m)return void console.log("Models are already loaded.");try{console.log("Loading models..."),[m,d,c]=await Promise.all([r(),a.wV.create(s,{executionProviders:["wasm"]}),i.Fz(i.JZ.MediaPipeFaceMesh,{runtime:"tfjs",refineLandmarks:!1})]),console.log("All models loaded successfully.")}catch(e){console.error("Failed to load models:",e)}}async function w(e){if(!c||!m||!d)throw Error("Models not loaded.");let n=await c.estimateFaces(e);if(0===n.length)return null;let{keypoints:t,box:o}=n[0],a=m.imread(e),i=new m.Rect(o.xMin,o.yMin,o.width,o.height),l=a.roi(i),r=[new m.Point(38.2946,51.6963),new m.Point(73.5318,51.5014),new m.Point(56.0252,71.7366)].map(e=>new m.Point(+e.x,+e.y)),s=[new m.Point(t[33].x-o.xMin,t[33].y-o.yMin),new m.Point(t[263].x-o.xMin,t[263].y-o.yMin),new m.Point(t[1].x-o.xMin,t[1].y-o.yMin)],u=m.matFromArray(3,2,m.CV_32F,s.flatMap(e=>[e.x,e.y])),w=m.matFromArray(3,2,m.CV_32F,r.flatMap(e=>[e.x,e.y])),f=m.getAffineTransform(u,w),y=new m.Mat,p=new m.Size(112,112);m.warpAffine(l,y,f,p,m.INTER_LINEAR,m.BORDER_CONSTANT,new m.Scalar);let h=document.createElement("canvas");return h.width=p.width,h.height=p.height,m.imshow(h,y),a.delete(),l.delete(),y.delete(),f.delete(),u.delete(),w.delete(),h}async function f(e){if(!d||!c)return console.error("Models not loaded. Call loadModels() first."),null;let n=await w(e);if(!n)return console.warn("Could not align face, skipping embedding."),null;let t=o.DZQ(()=>o.TaL.fromPixels(n).toFloat().div(o.d_2(255)).expandDims(0).transpose([0,3,1,2])),i=new a.qY("float32",t.dataSync(),t.shape),l={[d.inputNames[0]]:i},r=(await d.run(l))[d.outputNames[0]],s=o.OEK(r.data,[...r.dims]);return t.dispose(),s}function y(e,n){let t=e.norm(),o=n.norm(),a=e.dot(n.transpose()),i=a.div(t.mul(o)).dataSync()[0];return t.dispose(),o.dispose(),a.dispose(),i}},41234:()=>{},70562:()=>{},80551:()=>{},85817:()=>{}}]);