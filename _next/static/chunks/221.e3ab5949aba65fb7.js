(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[221],{4530:()=>{},8108:()=>{},18590:()=>{},40274:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>S});var s=t(95155),a=t(12115),n=t(1490),r=t(84932),i=t(27476),o=t(19874),c=t.n(o);let d="".concat("/Biometrics-SimFace-Web","/models/edgeface_s_gamma_05.onnx"),m=null,u=null,x=null;async function g(){if(m&&u&&x)return void console.log("Models are already loaded.");try{console.log("Loading models..."),[x,m,u]=await Promise.all([c(),r.wV.create(d,{executionProviders:["wasm"]}),i.Fz(i.JZ.MediaPipeFaceMesh,{runtime:"tfjs",refineLandmarks:!1})]),console.log("All models loaded successfully.")}catch(e){console.error("Failed to load models:",e)}}async function f(e){if(!u||!x||!m)throw Error("Models not loaded.");let l=await u.estimateFaces(e);if(0===l.length)return null;let{keypoints:t,box:s}=l[0],a=x.imread(e),n=new x.Rect(s.xMin,s.yMin,s.width,s.height),r=a.roi(n),i=[new x.Point(38.2946,51.6963),new x.Point(73.5318,51.5014),new x.Point(56.0252,71.7366)].map(e=>new x.Point(+e.x,+e.y)),o=[new x.Point(t[33].x-s.xMin,t[33].y-s.yMin),new x.Point(t[263].x-s.xMin,t[263].y-s.yMin),new x.Point(t[1].x-s.xMin,t[1].y-s.yMin)],c=x.matFromArray(3,2,x.CV_32F,o.flatMap(e=>[e.x,e.y])),d=x.matFromArray(3,2,x.CV_32F,i.flatMap(e=>[e.x,e.y])),g=x.getAffineTransform(c,d),f=new x.Mat,h=new x.Size(112,112);x.warpAffine(r,f,g,h,x.INTER_LINEAR,x.BORDER_CONSTANT,new x.Scalar);let p=document.createElement("canvas");return p.width=h.width,p.height=h.height,x.imshow(p,f),a.delete(),r.delete(),f.delete(),g.delete(),c.delete(),d.delete(),p}async function h(e){if(!m||!u)return console.error("Models not loaded. Call loadModels() first."),null;let l=await f(e);if(!l)return console.warn("Could not align face, skipping embedding."),null;let t=n.DZQ(()=>n.TaL.fromPixels(l).toFloat().div(n.d_2(255)).expandDims(0).transpose([0,3,1,2])),s=new r.qY("float32",t.dataSync(),t.shape),a={[m.inputNames[0]]:s},i=(await m.run(a))[m.outputNames[0]],o=n.OEK(i.data,[...i.dims]);return t.dispose(),o}let p=e=>{let{onImageSelect:l}=e;return(0,s.jsx)("div",{children:(0,s.jsx)("input",{id:"file-upload",type:"file",accept:"image/*",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];if(s){let e=new FileReader;e.onloadend=()=>{l(e.result)},e.readAsDataURL(s)}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})})};function y(e){let{similarity:l}=e;if(null===l)return(0,s.jsxs)("div",{className:"w-full max-w-sm rounded-lg bg-white p-6 text-center shadow-lg animate-fade-in",children:[(0,s.jsx)("p",{className:"rounded-lg bg-gray-100 px-6 py-2 text-lg font-bold text-gray-500",children:"Waiting"}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Select two images to see the similarity score."})})]});let t=l>=.6?"Match":"No Match",a="Match"===t;return(0,s.jsxs)("div",{className:"w-full max-w-sm rounded-lg bg-white p-6 text-center shadow-lg animate-fade-in",children:[(0,s.jsx)("p",{className:"rounded-lg px-6 py-2 text-xl font-bold transition-colors duration-300 ".concat(a?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Match Score: ",l.toFixed(4)]})})]})}var b=t(15239);let w=e=>{let{images:l,onSelect:t}=e;return(0,s.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-4 max-h-[60vh] overflow-y-auto p-2 border rounded-lg",children:l.map(e=>(0,s.jsx)("div",{className:"cursor-pointer relative aspect-square",onClick:()=>t(e),children:(0,s.jsx)(b.default,{src:e,alt:e,layout:"fill",className:"rounded-lg object-cover"})},e))})},j=e=>{let{isOpen:l,onClose:t,title:a,children:n}=e;return l?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex justify-center items-center p-4 modal-backdrop transition-all",onClick:t,children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-3xl",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold text-gray-800",children:a}),(0,s.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-gray-800 text-3xl font-bold",children:"\xd7"})]}),(0,s.jsx)("div",{children:n})]})}):null};var N=t(90287),v=t(82820);function S(e){let{galleryImages:l,probeImages:t}=e,[n,r]=(0,a.useState)(null),[i,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[m,u]=(0,a.useState)(!0),[x,f]=(0,a.useState)(!1),[b,S]=(0,a.useState)(!1),[M,C]=(0,a.useState)(null),k=(0,a.useRef)(null),F=(0,a.useRef)(null);(0,a.useEffect)(()=>{!async function(){await g(),u(!1)}()},[]);let P=async()=>{if(k.current&&F.current){f(!0);let e=await h(k.current),l=await h(F.current);e&&l&&(d(function(e,l){let t=e.norm(),s=l.norm(),a=e.dot(l.transpose()),n=a.div(t.mul(s)).dataSync()[0];return t.dispose(),s.dispose(),a.dispose(),n}(e,l)),e.dispose(),l.dispose()),f(!1)}},_=()=>{S(!1),C(null)},A=e=>{r(e),d(null),_()},E=e=>{o(e),d(null),_()},R=e=>{"gallery"===e?C({title:"Gallery 1",images:l,onSelect:A}):C({title:"Gallery 2",images:t,onSelect:E}),S(!0)};return m?(0,s.jsx)(v.A,{}):(0,s.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 sm:p-16 bg-gray-100",children:[(0,s.jsx)(j,{isOpen:b,onClose:_,title:(null==M?void 0:M.title)||"",children:M&&(0,s.jsx)(w,{images:M.images,onSelect:M.onSelect})}),(0,s.jsx)("h1",{className:"text-4xl font-bold text-center text-gray-800 mb-4",children:"\uD83D\uDE00 SimFace"}),(0,s.jsx)("p",{className:"text-gray-500 mb-8",children:"Compare any two faces and see the biometric result"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 w-full max-w-4xl",children:[(0,s.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4 text-gray-500",children:"1."}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(p,{onImageSelect:A}),l.length>0&&(0,s.jsx)("button",{onClick:()=>R("gallery"),className:"w-full px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 cursor-pointer transition-colors",children:"Select from Gallery"}),(0,s.jsx)("div",{className:"aspect-square bg-gray-100 flex items-center justify-center rounded-lg",children:n?(0,s.jsx)("img",{ref:k,src:n,alt:"Face 1",className:"rounded-lg aspect-square object-cover",crossOrigin:"anonymous"}):(0,s.jsx)(N.A,{className:"w-20 bg-gray-100"})})]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,s.jsx)(y,{similarity:c}),(0,s.jsx)("button",{onClick:P,disabled:!n||!i||x,className:"mt-8 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 disabled:bg-gray-400 cursor-pointer transition-colors",children:x?"Comparing..":"Compare"})]}),(0,s.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4 text-gray-500",children:"2."}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(p,{onImageSelect:E}),t.length>0&&(0,s.jsx)("button",{onClick:()=>R("probe"),className:"w-full px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 cursor-pointer transition-colors",children:"Select from Gallery"}),(0,s.jsx)("div",{className:"aspect-square bg-gray-100 flex items-center justify-center rounded-lg",children:i?(0,s.jsx)("img",{ref:F,src:i,alt:"Face 2",className:"rounded-lg aspect-square object-cover",crossOrigin:"anonymous"}):(0,s.jsx)(N.A,{className:"w-20 bg-gray-100"})})]})]})]})]})}},41234:()=>{},70562:()=>{},80551:()=>{},85817:()=>{}}]);