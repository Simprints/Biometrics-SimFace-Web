(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[221],{4530:()=>{},8108:()=>{},18590:()=>{},40274:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>N});var a=t(95155),s=t(12115),n=t(1490),r=t(84932),i=t(27476),o=t(19874),d=t.n(o);let c="".concat("/Biometrics-SimFace-Web","/models/edgeface_s_gamma_05.onnx"),m=null,u=null,x=null;async function g(){if(m&&u&&x)return void console.log("Models are already loaded.");try{console.log("Loading models..."),[x,m,u]=await Promise.all([d(),r.wV.create(c,{executionProviders:["wasm"]}),i.Fz(i.JZ.MediaPipeFaceMesh,{runtime:"tfjs",refineLandmarks:!1})]),console.log("All models loaded successfully.")}catch(e){console.error("Failed to load models:",e)}}async function f(e){if(!u||!x||!m)throw Error("Models not loaded.");let l=await u.estimateFaces(e);if(0===l.length)return null;let{keypoints:t,box:a}=l[0],s=x.imread(e),n=new x.Rect(a.xMin,a.yMin,a.width,a.height),r=s.roi(n),i=[new x.Point(38.2946,51.6963),new x.Point(73.5318,51.5014),new x.Point(56.0252,71.7366)].map(e=>new x.Point(+e.x,+e.y)),o=[new x.Point(t[33].x-a.xMin,t[33].y-a.yMin),new x.Point(t[263].x-a.xMin,t[263].y-a.yMin),new x.Point(t[1].x-a.xMin,t[1].y-a.yMin)],d=x.matFromArray(3,2,x.CV_32F,o.flatMap(e=>[e.x,e.y])),c=x.matFromArray(3,2,x.CV_32F,i.flatMap(e=>[e.x,e.y])),g=x.getAffineTransform(d,c),f=new x.Mat,h=new x.Size(112,112);x.warpAffine(r,f,g,h,x.INTER_LINEAR,x.BORDER_CONSTANT,new x.Scalar);let p=document.createElement("canvas");return p.width=h.width,p.height=h.height,x.imshow(p,f),s.delete(),r.delete(),f.delete(),g.delete(),d.delete(),c.delete(),p}async function h(e){if(!m||!u)return console.error("Models not loaded. Call loadModels() first."),null;let l=await f(e);if(!l)return console.warn("Could not align face, skipping embedding."),null;let t=n.DZQ(()=>n.TaL.fromPixels(l).toFloat().div(n.d_2(255)).expandDims(0).transpose([0,3,1,2])),a=new r.qY("float32",t.dataSync(),t.shape),s={[m.inputNames[0]]:a},i=(await m.run(s))[m.outputNames[0]],o=n.OEK(i.data,[...i.dims]);return t.dispose(),o}let p=e=>{let{onImageSelect:l}=e;return(0,a.jsx)("div",{children:(0,a.jsx)("input",{id:"file-upload",type:"file",accept:"image/*",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){let e=new FileReader;e.onloadend=()=>{l(e.result)},e.readAsDataURL(a)}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})})};function y(e){let{similarity:l}=e;if(null===l)return null;let t=l>=.6?"Match":"No-Match",s="Match"===t;return(0,a.jsxs)("div",{className:"mt-12 w-full max-w-md rounded-lg bg-white p-6 text-center shadow-lg animate-fade-in",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"Result"}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("p",{className:"text-lg text-gray-600",children:"Similarity Score:"}),(0,a.jsx)("p",{className:"text-4xl font-mono font-bold text-gray-900",children:l.toFixed(4)})]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("p",{className:"rounded-full px-6 py-2 text-xl font-bold transition-colors duration-300 ".concat(s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t})})]})}var b=t(15239);let w=e=>{let{images:l,onSelect:t}=e;return(0,a.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-4 max-h-[60vh] overflow-y-auto p-2 border rounded-lg",children:l.map(e=>(0,a.jsx)("div",{className:"cursor-pointer relative aspect-square",onClick:()=>t(e),children:(0,a.jsx)(b.default,{src:e,alt:e,layout:"fill",className:"rounded-lg object-cover"})},e))})},j=e=>{let{isOpen:l,onClose:t,title:s,children:n}=e;return l?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex justify-center items-center p-4 modal-backdrop",onClick:t,children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-3xl",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-800",children:s}),(0,a.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-gray-800 text-3xl font-bold",children:"\xd7"})]}),(0,a.jsx)("div",{children:n})]})}):null};function N(e){let{galleryImages:l,probeImages:t}=e,[n,r]=(0,s.useState)(null),[i,o]=(0,s.useState)(null),[d,c]=(0,s.useState)(null),[m,u]=(0,s.useState)(!0),[x,f]=(0,s.useState)("Loading models..."),[b,N]=(0,s.useState)(!1),[v,S]=(0,s.useState)(null),M=(0,s.useRef)(null),C=(0,s.useRef)(null);(0,s.useEffect)(()=>{!async function(){await g(),f(""),u(!1)}()},[]);let F=async()=>{if(M.current&&C.current){u(!0),f("Generating embeddings...");let e=await h(M.current),l=await h(C.current);e&&l&&(f("Comparing embeddings..."),c(function(e,l){let t=e.norm(),a=l.norm(),s=e.dot(l.transpose()),n=s.div(t.mul(a)).dataSync()[0];return t.dispose(),a.dispose(),s.dispose(),n}(e,l)),e.dispose(),l.dispose()),f(""),u(!1)}},k=()=>{N(!1),S(null)},P=e=>{r(e),c(null),k()},_=e=>{o(e),c(null),k()},R=e=>{"gallery"===e?S({title:"Select from Gallery",images:l,onSelect:P}):S({title:"Select from Probe",images:t,onSelect:_}),N(!0)};return(0,a.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 sm:p-24 bg-gray-100",children:[(0,a.jsx)(j,{isOpen:b,onClose:k,title:(null==v?void 0:v.title)||"",children:v&&(0,a.jsx)(w,{images:v.images,onSelect:v.onSelect})}),(0,a.jsx)("h1",{className:"text-4xl font-bold text-center text-gray-800 mb-8",children:"SimFace Demo"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-4xl",children:[(0,a.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-gray-700 text-center",children:"Face 1"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(p,{onImageSelect:P}),l.length>0&&(0,a.jsx)("button",{onClick:()=>R("gallery"),className:"w-full px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Select from Gallery"}),n&&(0,a.jsx)("img",{ref:M,src:n,alt:"Face 1",className:"mt-4 rounded-lg aspect-square object-cover",crossOrigin:"anonymous"})]})]}),(0,a.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-gray-700 text-center",children:"Face 2"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(p,{onImageSelect:_}),t.length>0&&(0,a.jsx)("button",{onClick:()=>R("probe"),className:"w-full px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Select from Gallery"}),i&&(0,a.jsx)("img",{ref:C,src:i,alt:"Face 2",className:"mt-4 rounded-lg aspect-square object-cover",crossOrigin:"anonymous"})]})]})]}),(0,a.jsx)("button",{onClick:F,disabled:!n||!i||m,className:"mt-8 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 disabled:bg-gray-400",children:m?"Comparing...":"Compare"}),m&&(0,a.jsx)("p",{className:"text-lg text-gray-600 my-4",children:x}),null!==d&&(0,a.jsx)(y,{similarity:d})]})}},41234:()=>{},70562:()=>{},80551:()=>{},85817:()=>{}}]);