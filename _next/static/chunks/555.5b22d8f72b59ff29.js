(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[555],{4530:()=>{},8108:()=>{},14312:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>E});var a=l(95155),s=l(12115),r=l(1490),n=l(84932),i=l(27476),o=l(19874),c=l.n(o);let d="".concat("/Biometrics-SimFace-Web","/models/edgeface_s_gamma_05.onnx"),m=null,u=null,x=null;class g extends Error{constructor(e){super(e),this.name="FaceAlignmentError"}}async function h(){if(m&&u&&x)return void console.log("Models are already loaded.");try{console.log("Loading models..."),[x,m,u]=await Promise.all([c(),n.wV.create(d,{executionProviders:["wasm"]}),i.Fz(i.JZ.MediaPipeFaceMesh,{runtime:"tfjs",refineLandmarks:!1})]),console.log("All models loaded successfully.")}catch(e){console.error("Failed to load models:",e)}}async function f(e){if(!u||!x||!m)throw Error("Models not loaded.");let t=await u.estimateFaces(e);if(0===t.length)return null;let{keypoints:l,box:a}=t[0],s=x.imread(e),r=new x.Rect(a.xMin,a.yMin,a.width,a.height),n=s.roi(r),i=[new x.Point(38.2946,51.6963),new x.Point(73.5318,51.5014),new x.Point(56.0252,71.7366)].map(e=>new x.Point(+e.x,+e.y)),o=[new x.Point(l[33].x-a.xMin,l[33].y-a.yMin),new x.Point(l[263].x-a.xMin,l[263].y-a.yMin),new x.Point(l[1].x-a.xMin,l[1].y-a.yMin)],c=x.matFromArray(3,2,x.CV_32F,o.flatMap(e=>[e.x,e.y])),d=x.matFromArray(3,2,x.CV_32F,i.flatMap(e=>[e.x,e.y])),g=x.getAffineTransform(c,d),h=new x.Mat,f=new x.Size(112,112);x.warpAffine(n,h,g,f,x.INTER_LINEAR,x.BORDER_CONSTANT,new x.Scalar);let p=document.createElement("canvas");return p.width=f.width,p.height=f.height,x.imshow(p,h),s.delete(),n.delete(),h.delete(),g.delete(),c.delete(),d.delete(),p}async function p(e){if(!m||!u)throw console.error("Models not loaded. Call loadModels() first."),Error("Models not loaded");let t=await f(e);if(!t)throw new g("Could not detect a face. Please try a different image.");let l=r.DZQ(()=>r.TaL.fromPixels(t).toFloat().div(r.d_2(255)).expandDims(0).transpose([0,3,1,2])),a=new n.qY("float32",l.dataSync(),l.shape),s={[m.inputNames[0]]:a},i=(await m.run(s))[m.outputNames[0]],o=r.OEK(i.data,[...i.dims]);return l.dispose(),o}function y(e){let{similarity:t}=e;if(null===t)return(0,a.jsxs)("div",{className:"w-full max-w-sm rounded-lg bg-white p-6 text-center shadow-lg animate-fade-in",children:[(0,a.jsx)("p",{className:"rounded-lg bg-gray-100 px-6 py-2 text-lg font-bold text-gray-500",children:"Waiting"}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Select two images"})})]});let l=t>=.5?"Match":"No Match",s="Match"===l;return(0,a.jsxs)("div",{className:"w-full max-w-sm rounded-lg bg-white p-6 text-center shadow-lg animate-fade-in",children:[(0,a.jsx)("p",{className:"rounded-lg px-6 py-2 text-xl font-bold transition-colors duration-300 ".concat(s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:l}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Match Score: ",t.toFixed(4)]})})]})}var w=l(15239);let j=e=>{let{images:t,onSelect:l,trueMatch:s}=e;return(0,a.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-4 max-h-[60vh] overflow-y-auto p-2 border rounded-lg",children:t.map(e=>{let t="border-transparent";return e===s&&(t="ring ring-3 ring-green-400"),(0,a.jsx)("div",{className:"cursor-pointer relative aspect-square ".concat(t," rounded-lg overflow-hidden"),onClick:()=>l(e),children:(0,a.jsx)(w.default,{src:e,alt:e,layout:"fill",className:"rounded-lg object-cover"})},e)})})},N=e=>{let{isOpen:t,onClose:l,title:s,children:r}=e;return t?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex justify-center items-center p-4 modal-backdrop transition-all",onClick:l,children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-3xl",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-800",children:s}),(0,a.jsx)("button",{onClick:l,className:"text-gray-500 hover:text-gray-800 text-3xl font-bold",children:"\xd7"})]}),(0,a.jsx)("div",{children:r})]})}):null};var v=l(82820),b=l(90287),S=l(46696),M=l(69245),C=l(66716);let F=e=>{let{onImageSelect:t,id:l}=e;return(0,a.jsx)("div",{children:(0,a.jsxs)("label",{htmlFor:l,className:"cursor-pointer flex items-center space-x-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:[(0,a.jsx)(C.A,{className:"w-6 h-6"}),(0,a.jsx)("span",{className:"font-semibold text-sm",children:"Upload"}),(0,a.jsx)("input",{id:l,type:"file",accept:"image/*",onChange:e=>{var l;let a=null==(l=e.target.files)?void 0:l[0];if(a){let e=new FileReader;e.onloadend=()=>{t(e.result)},e.readAsDataURL(a)}},className:"hidden"})]})})},k=e=>{let{onClick:t,icon:l,text:s}=e;return(0,a.jsxs)("button",{onClick:t,className:"flex items-center space-x-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 cursor-pointer transition-colors w-full",children:[l,(0,a.jsx)("span",{className:"font-semibold text-sm",children:s})]})},A=e=>{let{title:t,imageSrc:l,onImageSelect:s,onGalleryClick:r,hasGallery:n,uploaderId:i,error:o}=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4 text-gray-500",children:t}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"aspect-square bg-gray-100 flex items-center justify-center rounded-lg mb-6 relative",children:l?(0,a.jsx)("img",{src:l,alt:"Face for comparison ".concat(t),className:"rounded-lg aspect-square object-cover",crossOrigin:"anonymous"}):(0,a.jsx)(b.A,{className:"w-20 bg-gray-100 text-gray-300"})}),n&&(0,a.jsx)(k,{onClick:r,icon:(0,a.jsx)(S.A,{className:"w-6 h-6"}),text:"Gallery"}),n&&(0,a.jsxs)("div",{className:"relative flex items-center mx-5",children:[(0,a.jsx)("div",{className:"flex-grow border-t border-gray-300"}),(0,a.jsx)("span",{className:"flex-shrink mx-4 text-xs text-gray-400",children:"or"}),(0,a.jsx)("div",{className:"flex-grow border-t border-gray-300"})]}),(0,a.jsx)(F,{onImageSelect:s,id:i})]})]}),o&&(0,a.jsxs)("div",{className:"flex items-center text-red-500 text-sm my-4",children:[(0,a.jsx)(M.A,{className:"w-5 h-5 mr-2"}),o]})]})};function E(e){let{galleryImages:t,probeImages:l}=e,[n,i]=(0,s.useState)(null),[o,c]=(0,s.useState)(null),[d,m]=(0,s.useState)(null),[u,x]=(0,s.useState)(null),[f,w]=(0,s.useState)(null),[b,S]=(0,s.useState)(!0),[M,C]=(0,s.useState)(!1),[F,k]=(0,s.useState)(null),[E,P]=(0,s.useState)(null),[_,I]=(0,s.useState)(null),[D,G]=(0,s.useState)(null),[R,L]=(0,s.useState)(null);(0,s.useEffect)(()=>{!async function(){await h(),S(!1)}()},[]),(0,s.useEffect)(()=>{d&&u&&w(r.DZQ(()=>{let e=d.norm(),t=u.norm();return d.dot(u.transpose()).div(e.mul(t)).dataSync()[0]}))},[d,u]);let O=()=>{C(!1),k(null)},T=(e,t)=>{var l;let a=null==(l=e.split("/").pop())?void 0:l.substring(0,6);return t.find(e=>{var t;return null==(t=e.split("/").pop())?void 0:t.startsWith(null!=a?a:"")})||null},q=async(e,t,l,a)=>{null==a||a.dispose(),t(null),l(null);try{let l=await p(e);t(l)}catch(e){e instanceof g?l(e.message):(l("An unknown error occurred during validation."),console.error(e))}},z=e=>{i(e),I(T(e,l)),w(null),O();let t=new Image;t.src=e,t.onload=()=>{q(t,m,G,d)},t.onerror=()=>{G("Failed to load image for processing.")}},V=e=>{c(e),P(T(e,t)),w(null),O();let l=new Image;l.src=e,l.onload=()=>{q(l,x,L,u)},l.onerror=()=>{L("Failed to load image for processing.")}},W=e=>{"gallery"===e?k({title:"Gallery 1",images:t,onSelect:z,trueMatch:E}):k({title:"Gallery 2",images:l,onSelect:V,trueMatch:_}),C(!0)};return b?(0,a.jsx)(v.A,{}):(0,a.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 sm:p-16 bg-gray-100",children:[(0,a.jsx)(N,{isOpen:M,onClose:O,title:(null==F?void 0:F.title)||"",children:F&&(0,a.jsx)(j,{images:F.images,onSelect:F.onSelect,trueMatch:F.trueMatch})}),(0,a.jsx)("h1",{className:"text-4xl font-bold text-center text-gray-800 mb-4",children:"\uD83D\uDE00 SimFace"}),(0,a.jsx)("p",{className:"text-gray-500 mb-8",children:"Compare any two faces and see the biometric result"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 w-full max-w-4xl",children:[(0,a.jsx)(A,{title:"1.",imageSrc:n,onImageSelect:z,onGalleryClick:()=>W("gallery"),hasGallery:t.length>0,uploaderId:"file-upload-1",error:D}),(0,a.jsx)("div",{className:"flex flex-col items-center justify-center",children:(0,a.jsx)(y,{similarity:f})}),(0,a.jsx)(A,{title:"2.",imageSrc:o,onImageSelect:V,onGalleryClick:()=>W("probe"),hasGallery:l.length>0,uploaderId:"file-upload-2",error:R})]})]})}},18590:()=>{},41234:()=>{},70562:()=>{},80551:()=>{},85817:()=>{}}]);