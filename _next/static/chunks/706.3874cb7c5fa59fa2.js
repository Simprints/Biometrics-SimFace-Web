(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[706],{4530:()=>{},8108:()=>{},18590:()=>{},31635:(e,n,t)=>{"use strict";t.r(n),t.d(n,{cosineSimilarity:()=>w,getEmbedding:()=>f,loadModels:()=>u});var o=t(1490),a=t(84932),l=t(27476),i=t(19874),r=t.n(i);let s=null,d=null,c=null;async function u(){if(s&&d&&c)return void console.log("Models are already loaded.");try{console.log("Loading models..."),[c,s,d]=await Promise.all([r(),a.wV.create("./models/facenet.onnx",{executionProviders:["wasm"]}),l.Fz(l.JZ.MediaPipeFaceMesh,{runtime:"tfjs",refineLandmarks:!1})]),console.log("All models loaded successfully.")}catch(e){console.error("Failed to load models:",e)}}async function m(e){if(!d||!c||!s)throw Error("Models not loaded.");let n=await d.estimateFaces(e);if(0===n.length)return null;let t=n[0].keypoints,o=[new c.Point(38.2946,51.6963),new c.Point(73.5318,51.5014),new c.Point(56.0252,71.7366)],a=160/112,l=o.map(e=>new c.Point(e.x*a,e.y*a)),i=[new c.Point(t[33].x,t[33].y),new c.Point(t[263].x,t[263].y),new c.Point(t[1].x,t[1].y)],r=c.matFromArray(3,2,c.CV_32F,i.flatMap(e=>[e.x,e.y])),u=c.matFromArray(3,2,c.CV_32F,l.flatMap(e=>[e.x,e.y])),m=c.getAffineTransform(r,u),f=c.imread(e),w=new c.Mat,p=new c.Size(160,160);c.warpAffine(f,w,m,p,c.INTER_LINEAR,c.BORDER_CONSTANT,new c.Scalar);let y=document.createElement("canvas");return y.width=p.width,y.height=p.height,c.imshow(y,w),f.delete(),w.delete(),m.delete(),r.delete(),u.delete(),y}async function f(e){if(!s||!d)return console.error("Models not loaded. Call loadModels() first."),null;let n=await m(e);if(!n)return console.warn("Could not align face, skipping embedding."),null;let t=o.DZQ(()=>o.TaL.fromPixels(n).toFloat().div(o.d_2(255)).expandDims(0)),l=new a.qY("float32",t.dataSync(),t.shape),i={[s.inputNames[0]]:l},r=(await s.run(i))[s.outputNames[0]],c=o.OEK(r.data,[...r.dims]);return t.dispose(),c}function w(e,n){let t=e.norm(),o=n.norm(),a=e.dot(n.transpose()),l=a.div(t.mul(o)).dataSync()[0];return t.dispose(),o.dispose(),a.dispose(),l}},41234:()=>{},70562:()=>{},80551:()=>{},85817:()=>{}}]);