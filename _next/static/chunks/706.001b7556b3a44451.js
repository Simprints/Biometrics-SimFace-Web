(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[706],{4530:()=>{},8108:()=>{},18590:()=>{},31635:(e,n,t)=>{"use strict";t.r(n),t.d(n,{cosineSimilarity:()=>p,getEmbedding:()=>w,loadModels:()=>u});var o=t(1490),a=t(84932),l=t(27476),i=t(19874),r=t.n(i);let s="".concat("/Biometrics-SimFace-Web","/models/facenet.onnx"),d=null,c=null,m=null;async function u(){if(d&&c&&m)return void console.log("Models are already loaded.");try{console.log("Loading models..."),[m,d,c]=await Promise.all([r(),a.wV.create(s,{executionProviders:["wasm"]}),l.Fz(l.JZ.MediaPipeFaceMesh,{runtime:"tfjs",refineLandmarks:!1})]),console.log("All models loaded successfully.")}catch(e){console.error("Failed to load models:",e)}}async function f(e){if(!c||!m||!d)throw Error("Models not loaded.");let n=await c.estimateFaces(e);if(0===n.length)return null;let t=n[0].keypoints,o=[new m.Point(38.2946,51.6963),new m.Point(73.5318,51.5014),new m.Point(56.0252,71.7366)],a=160/112,l=o.map(e=>new m.Point(e.x*a,e.y*a)),i=[new m.Point(t[33].x,t[33].y),new m.Point(t[263].x,t[263].y),new m.Point(t[1].x,t[1].y)],r=m.matFromArray(3,2,m.CV_32F,i.flatMap(e=>[e.x,e.y])),s=m.matFromArray(3,2,m.CV_32F,l.flatMap(e=>[e.x,e.y])),u=m.getAffineTransform(r,s),f=m.imread(e),w=new m.Mat,p=new m.Size(160,160);m.warpAffine(f,w,u,p,m.INTER_LINEAR,m.BORDER_CONSTANT,new m.Scalar);let y=document.createElement("canvas");return y.width=p.width,y.height=p.height,m.imshow(y,w),f.delete(),w.delete(),u.delete(),r.delete(),s.delete(),y}async function w(e){if(!d||!c)return console.error("Models not loaded. Call loadModels() first."),null;let n=await f(e);if(!n)return console.warn("Could not align face, skipping embedding."),null;let t=o.DZQ(()=>o.TaL.fromPixels(n).toFloat().div(o.d_2(255)).expandDims(0)),l=new a.qY("float32",t.dataSync(),t.shape),i={[d.inputNames[0]]:l},r=(await d.run(i))[d.outputNames[0]],s=o.OEK(r.data,[...r.dims]);return t.dispose(),s}function p(e,n){let t=e.norm(),o=n.norm(),a=e.dot(n.transpose()),l=a.div(t.mul(o)).dataSync()[0];return t.dispose(),o.dispose(),a.dispose(),l}},41234:()=>{},70562:()=>{},80551:()=>{},85817:()=>{}}]);