(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[706],{4530:()=>{},8108:()=>{},18590:()=>{},31635:(e,n,o)=>{"use strict";o.r(n),o.d(n,{cosineSimilarity:()=>p,getEmbedding:()=>w,loadModels:()=>u});var t=o(1490),a=o(84932),l=o(27476),i=o(19874),r=o.n(i);let s="".concat("/Biometrics-SimFace-Web","/models/edgeface_s_gamma_05.onnx"),d=null,c=null,m=null;async function u(){if(d&&c&&m)return void console.log("Models are already loaded.");try{console.log("Loading models..."),[m,d,c]=await Promise.all([r(),a.wV.create(s,{executionProviders:["wasm"]}),l.Fz(l.JZ.MediaPipeFaceMesh,{runtime:"tfjs",refineLandmarks:!1})]),console.log("All models loaded successfully.")}catch(e){console.error("Failed to load models:",e)}}async function f(e){if(!c||!m||!d)throw Error("Models not loaded.");let n=await c.estimateFaces(e);if(0===n.length)return null;let o=n[0].keypoints,t=[new m.Point(38.2946,51.6963),new m.Point(73.5318,51.5014),new m.Point(56.0252,71.7366)].map(e=>new m.Point(+e.x,+e.y)),a=[new m.Point(o[33].x,o[33].y),new m.Point(o[263].x,o[263].y),new m.Point(o[1].x,o[1].y)],l=m.matFromArray(3,2,m.CV_32F,a.flatMap(e=>[e.x,e.y])),i=m.matFromArray(3,2,m.CV_32F,t.flatMap(e=>[e.x,e.y])),r=m.getAffineTransform(l,i),s=m.imread(e),u=new m.Mat,f=new m.Size(112,112);m.warpAffine(s,u,r,f,m.INTER_LINEAR,m.BORDER_CONSTANT,new m.Scalar);let w=document.createElement("canvas");return w.width=f.width,w.height=f.height,m.imshow(w,u),s.delete(),u.delete(),r.delete(),l.delete(),i.delete(),w}async function w(e){if(!d||!c)return console.error("Models not loaded. Call loadModels() first."),null;let n=await f(e);if(!n)return console.warn("Could not align face, skipping embedding."),null;let o=t.DZQ(()=>t.TaL.fromPixels(n).toFloat().div(t.d_2(255)).expandDims(0).transpose([0,3,1,2])),l=new a.qY("float32",o.dataSync(),o.shape),i={[d.inputNames[0]]:l},r=(await d.run(i))[d.outputNames[0]],s=t.OEK(r.data,[...r.dims]);return o.dispose(),s}function p(e,n){let o=e.norm(),t=n.norm(),a=e.dot(n.transpose()),l=a.div(o.mul(t)).dataSync()[0];return o.dispose(),t.dispose(),a.dispose(),l}},41234:()=>{},70562:()=>{},80551:()=>{},85817:()=>{}}]);