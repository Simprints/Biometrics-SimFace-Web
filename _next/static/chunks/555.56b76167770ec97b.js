(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[555],{4530:()=>{},8108:()=>{},14312:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>F});var a=t(95155),s=t(12115),r=t(1490),n=t(84932),i=t(27476),o=t(19874),c=t.n(o);let d="".concat("/Biometrics-SimFace-Web","/models/edgeface_s_gamma_05.onnx"),m=null,x=null,u=null;async function g(){if(m&&x&&u)return void console.log("Models are already loaded.");try{console.log("Loading models..."),[u,m,x]=await Promise.all([c(),n.wV.create(d,{executionProviders:["wasm"]}),i.Fz(i.JZ.MediaPipeFaceMesh,{runtime:"tfjs",refineLandmarks:!1})]),console.log("All models loaded successfully.")}catch(e){console.error("Failed to load models:",e)}}async function h(e){if(!x||!u||!m)throw Error("Models not loaded.");let l=await x.estimateFaces(e);if(0===l.length)return null;let{keypoints:t,box:a}=l[0],s=u.imread(e),r=new u.Rect(a.xMin,a.yMin,a.width,a.height),n=s.roi(r),i=[new u.Point(38.2946,51.6963),new u.Point(73.5318,51.5014),new u.Point(56.0252,71.7366)].map(e=>new u.Point(+e.x,+e.y)),o=[new u.Point(t[33].x-a.xMin,t[33].y-a.yMin),new u.Point(t[263].x-a.xMin,t[263].y-a.yMin),new u.Point(t[1].x-a.xMin,t[1].y-a.yMin)],c=u.matFromArray(3,2,u.CV_32F,o.flatMap(e=>[e.x,e.y])),d=u.matFromArray(3,2,u.CV_32F,i.flatMap(e=>[e.x,e.y])),g=u.getAffineTransform(c,d),h=new u.Mat,f=new u.Size(112,112);u.warpAffine(n,h,g,f,u.INTER_LINEAR,u.BORDER_CONSTANT,new u.Scalar);let p=document.createElement("canvas");return p.width=f.width,p.height=f.height,u.imshow(p,h),s.delete(),n.delete(),h.delete(),g.delete(),c.delete(),d.delete(),p}async function f(e){if(!m||!x)return console.error("Models not loaded. Call loadModels() first."),null;let l=await h(e);if(!l)return console.warn("Could not align face, skipping embedding."),null;let t=r.DZQ(()=>r.TaL.fromPixels(l).toFloat().div(r.d_2(255)).expandDims(0).transpose([0,3,1,2])),a=new n.qY("float32",t.dataSync(),t.shape),s={[m.inputNames[0]]:a},i=(await m.run(s))[m.outputNames[0]],o=r.OEK(i.data,[...i.dims]);return t.dispose(),o}function p(e){let{similarity:l}=e;if(null===l)return(0,a.jsxs)("div",{className:"w-full max-w-sm rounded-lg bg-white p-6 text-center shadow-lg animate-fade-in",children:[(0,a.jsx)("p",{className:"rounded-lg bg-gray-100 px-6 py-2 text-lg font-bold text-gray-500",children:"Waiting"}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Select two images to see the similarity score."})})]});let t=l>=.6?"Match":"No Match",s="Match"===t;return(0,a.jsxs)("div",{className:"w-full max-w-sm rounded-lg bg-white p-6 text-center shadow-lg animate-fade-in",children:[(0,a.jsx)("p",{className:"rounded-lg px-6 py-2 text-xl font-bold transition-colors duration-300 ".concat(s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Match Score: ",l.toFixed(4)]})})]})}var y=t(15239);let w=e=>{let{images:l,onSelect:t}=e;return(0,a.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-4 max-h-[60vh] overflow-y-auto p-2 border rounded-lg",children:l.map(e=>(0,a.jsx)("div",{className:"cursor-pointer relative aspect-square",onClick:()=>t(e),children:(0,a.jsx)(y.default,{src:e,alt:e,layout:"fill",className:"rounded-lg object-cover"})},e))})},j=e=>{let{isOpen:l,onClose:t,title:s,children:r}=e;return l?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex justify-center items-center p-4 modal-backdrop transition-all",onClick:t,children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-3xl",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-800",children:s}),(0,a.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-gray-800 text-3xl font-bold",children:"\xd7"})]}),(0,a.jsx)("div",{children:r})]})}):null};var b=t(82820),N=t(90287),v=t(46696),S=t(66716);let C=e=>{let{onImageSelect:l,id:t}=e;return(0,a.jsx)("div",{children:(0,a.jsxs)("label",{htmlFor:t,className:"cursor-pointer flex items-center space-x-2 px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors",children:[(0,a.jsx)(S.A,{className:"w-6 h-6"}),(0,a.jsx)("span",{children:"Upload"}),(0,a.jsx)("input",{id:t,type:"file",accept:"image/*",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){let e=new FileReader;e.onloadend=()=>{l(e.result)},e.readAsDataURL(a)}},className:"hidden"})]})})},M=e=>{let{onClick:l,icon:t,text:s}=e;return(0,a.jsxs)("button",{onClick:l,className:"flex items-center space-x-2 px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 cursor-pointer transition-colors w-full",children:[t,(0,a.jsx)("span",{children:s})]})},k=e=>{let{title:l,imageSrc:t,imageRef:s,onImageSelect:r,onGalleryClick:n,hasGallery:i,uploaderId:o}=e;return(0,a.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4 text-gray-500",children:l}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"aspect-square bg-gray-100 flex items-center justify-center rounded-lg mb-6",children:t?(0,a.jsx)("img",{ref:s,src:t,alt:"Face for comparison ".concat(l),className:"rounded-lg aspect-square object-cover",crossOrigin:"anonymous"}):(0,a.jsx)(N.A,{className:"w-20 bg-gray-100 text-gray-300"})}),i&&(0,a.jsx)(M,{onClick:n,icon:(0,a.jsx)(v.A,{className:"w-6 h-6"}),text:"Gallery"}),i&&(0,a.jsxs)("div",{className:"relative flex items-center mx-5",children:[(0,a.jsx)("div",{className:"flex-grow border-t border-gray-300"}),(0,a.jsx)("span",{className:"flex-shrink mx-4 text-xs text-gray-400",children:"or"}),(0,a.jsx)("div",{className:"flex-grow border-t border-gray-300"})]}),(0,a.jsx)(C,{onImageSelect:r,id:o})]})]})};function F(e){let{galleryImages:l,probeImages:t}=e,[r,n]=(0,s.useState)(null),[i,o]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[m,x]=(0,s.useState)(!0),[u,h]=(0,s.useState)(!1),[y,N]=(0,s.useState)(!1),[v,S]=(0,s.useState)(null),C=(0,s.useRef)(null),M=(0,s.useRef)(null);(0,s.useEffect)(()=>{!async function(){await g(),x(!1)}()},[]);let F=async()=>{if(C.current&&M.current){h(!0);let e=await f(C.current),l=await f(M.current);e&&l&&(d(function(e,l){let t=e.norm(),a=l.norm(),s=e.dot(l.transpose()),r=s.div(t.mul(a)).dataSync()[0];return t.dispose(),a.dispose(),s.dispose(),r}(e,l)),e.dispose(),l.dispose()),h(!1)}},A=()=>{N(!1),S(null)},P=e=>{n(e),d(null),A()},_=e=>{o(e),d(null),A()},R=e=>{"gallery"===e?S({title:"Gallery 1",images:l,onSelect:P}):S({title:"Gallery 2",images:t,onSelect:_}),N(!0)};return m?(0,a.jsx)(b.A,{}):(0,a.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 sm:p-16 bg-gray-100",children:[(0,a.jsx)(j,{isOpen:y,onClose:A,title:(null==v?void 0:v.title)||"",children:v&&(0,a.jsx)(w,{images:v.images,onSelect:v.onSelect})}),(0,a.jsx)("h1",{className:"text-4xl font-bold text-center text-gray-800 mb-4",children:"\uD83D\uDE00 SimFace"}),(0,a.jsx)("p",{className:"text-gray-500 mb-8",children:"Compare any two faces and see the biometric result"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 w-full max-w-4xl",children:[(0,a.jsx)(k,{title:"1.",imageSrc:r,imageRef:C,onImageSelect:P,onGalleryClick:()=>R("gallery"),hasGallery:l.length>0,uploaderId:"file-upload-1"}),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,a.jsx)(p,{similarity:c}),(0,a.jsx)("button",{onClick:F,disabled:!r||!i||u,className:"mt-8 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 disabled:bg-gray-400 cursor-pointer transition-colors",children:u?"Comparing..":"Compare"})]}),(0,a.jsx)(k,{title:"2.",imageSrc:i,imageRef:M,onImageSelect:_,onGalleryClick:()=>R("probe"),hasGallery:t.length>0,uploaderId:"file-upload-2"})]})]})}},18590:()=>{},41234:()=>{},70562:()=>{},80551:()=>{},85817:()=>{}}]);